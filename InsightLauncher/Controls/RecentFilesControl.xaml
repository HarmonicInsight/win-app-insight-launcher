<UserControl x:Class="InsightLauncher.Controls.RecentFilesControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:InsightLauncher.ViewModels"
             xmlns:models="clr-namespace:InsightLauncher.Models">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Horizontal">
                <TextBlock Text="ðŸ“" FontSize="18" VerticalAlignment="Center"/>
                <TextBlock Text="æœ€è¿‘ä½¿ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«"
                           Style="{StaticResource SectionHeader}"
                           Margin="8,0,0,0"/>
            </StackPanel>

            <Button Grid.Column="1"
                    Style="{StaticResource IconButton}"
                    Command="{Binding RefreshCommand}">
                <TextBlock Text="ðŸ”„" FontSize="12"/>
            </Button>
        </Grid>

        <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,16">
            <Button Content="ã™ã¹ã¦"
                    Padding="12,6"
                    Margin="0,0,8,0"
                    Command="{Binding SetFilterCommand}"
                    CommandParameter="{x:Null}">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource GhostButton}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedFilter}" Value="{x:Null}">
                                <Setter Property="Background" Value="{StaticResource PrimaryBrush}"/>
                                <Setter Property="Foreground" Value="White"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            <Button Content="Excel"
                    Padding="12,6"
                    Margin="0,0,8,0"
                    Command="{Binding SetFilterCommand}"
                    CommandParameter="{x:Static models:FileType.Excel}">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource GhostButton}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedFilter}" Value="{x:Static models:FileType.Excel}">
                                <Setter Property="Background" Value="#166534"/>
                                <Setter Property="Foreground" Value="White"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            <Button Content="Word"
                    Padding="12,6"
                    Margin="0,0,8,0"
                    Command="{Binding SetFilterCommand}"
                    CommandParameter="{x:Static models:FileType.Word}">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource GhostButton}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedFilter}" Value="{x:Static models:FileType.Word}">
                                <Setter Property="Background" Value="#1D4ED8"/>
                                <Setter Property="Foreground" Value="White"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            <Button Content="PowerPoint"
                    Padding="12,6"
                    Command="{Binding SetFilterCommand}"
                    CommandParameter="{x:Static models:FileType.PowerPoint}">
                <Button.Style>
                    <Style TargetType="Button" BasedOn="{StaticResource GhostButton}">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedFilter}" Value="{x:Static models:FileType.PowerPoint}">
                                <Setter Property="Background" Value="#C2410C"/>
                                <Setter Property="Foreground" Value="White"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>

        <!-- ãƒ”ãƒ³ç•™ã‚ãƒ•ã‚¡ã‚¤ãƒ« -->
        <StackPanel Grid.Row="2"
                    Visibility="{Binding PinnedFiles.Count, Converter={StaticResource NullToVisibilityConverter}}">
            <TextBlock Text="ãƒ”ãƒ³ç•™ã‚"
                       Foreground="{StaticResource TextSecondaryBrush}"
                       FontWeight="Medium"
                       FontSize="12"
                       Margin="0,0,0,8"/>
            <ItemsControl ItemsSource="{Binding PinnedFiles}" Margin="0,0,0,16">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type models:RecentFile}">
                        <Border Background="{StaticResource PrimaryLightBrush}"
                                BorderBrush="{StaticResource PrimaryBrush}"
                                BorderThickness="1"
                                CornerRadius="6"
                                Padding="10"
                                Margin="0,0,0,6">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ -->
                                <Border Grid.Column="0"
                                        Width="36" Height="36"
                                        CornerRadius="4"
                                        Margin="0,0,10,0">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static models:FileType.Excel}">
                                                    <Setter Property="Background" Value="#166534"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static models:FileType.Word}">
                                                    <Setter Property="Background" Value="#1D4ED8"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static models:FileType.PowerPoint}">
                                                    <Setter Property="Background" Value="#C2410C"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock FontSize="16"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Text="{Binding Type, Converter={StaticResource FileTypeToIconConverter}}"/>
                                </Border>

                                <!-- ãƒ•ã‚¡ã‚¤ãƒ«å -->
                                <Button Grid.Column="1"
                                        Command="{Binding DataContext.OpenFileCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        HorizontalContentAlignment="Left"
                                        Cursor="Hand">
                                    <StackPanel>
                                        <TextBlock Text="{Binding Name}"
                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                   FontSize="13"
                                                   FontWeight="Medium"
                                                   TextTrimming="CharacterEllipsis"/>
                                        <TextBlock Text="{Binding FolderPath}"
                                                   Foreground="{StaticResource TextMutedBrush}"
                                                   FontSize="11"
                                                   TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                </Button>

                                <!-- æ—¥æ™‚ -->
                                <TextBlock Grid.Column="2"
                                           Foreground="{StaticResource TextMutedBrush}"
                                           FontSize="11"
                                           VerticalAlignment="Center"
                                           Margin="8,0"
                                           Text="{Binding LastModified, Converter={StaticResource DateToRelativeConverter}}"/>

                                <!-- ãƒ”ãƒ³è§£é™¤ -->
                                <Button Grid.Column="3"
                                        Style="{StaticResource IconButton}"
                                        Command="{Binding DataContext.TogglePinCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Width="28" Height="28">
                                    <TextBlock Text="ðŸ“Œ" FontSize="12"/>
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>

        <!-- ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆ -->
        <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding FilteredFiles}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate DataType="{x:Type models:RecentFile}">
                        <Border Background="Transparent"
                                CornerRadius="6"
                                Padding="10"
                                Margin="0,0,0,4">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource BackgroundHoverBrush}"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ -->
                                <Border Grid.Column="0"
                                        Width="40" Height="40"
                                        CornerRadius="4"
                                        Margin="0,0,12,0">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="{StaticResource BackgroundSecondaryBrush}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static models:FileType.Excel}">
                                                    <Setter Property="Background" Value="#166534"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static models:FileType.Word}">
                                                    <Setter Property="Background" Value="#1D4ED8"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Type}" Value="{x:Static models:FileType.PowerPoint}">
                                                    <Setter Property="Background" Value="#C2410C"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock FontSize="20"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               Text="{Binding Type, Converter={StaticResource FileTypeToIconConverter}}"/>
                                </Border>

                                <!-- ãƒ•ã‚¡ã‚¤ãƒ«åã¨ãƒ‘ã‚¹ -->
                                <Button Grid.Column="1"
                                        Command="{Binding DataContext.OpenFileCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        HorizontalContentAlignment="Left"
                                        Cursor="Hand">
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Name}"
                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                   FontSize="13"
                                                   FontWeight="Medium"
                                                   TextTrimming="CharacterEllipsis"/>
                                        <TextBlock Foreground="{StaticResource TextMutedBrush}"
                                                   FontSize="11"
                                                   Margin="0,2,0,0"
                                                   TextTrimming="CharacterEllipsis"
                                                   Text="{Binding FolderPath}"
                                                   ToolTip="{Binding Path}"/>
                                    </StackPanel>
                                </Button>

                                <!-- æœ€çµ‚æ›´æ–°æ—¥æ™‚ -->
                                <TextBlock Grid.Column="2"
                                           Foreground="{StaticResource TextMutedBrush}"
                                           FontSize="11"
                                           VerticalAlignment="Center"
                                           Margin="12,0"
                                           Text="{Binding LastModified, Converter={StaticResource DateToRelativeConverter}}"/>

                                <!-- ãƒ”ãƒ³ç•™ã‚ãƒœã‚¿ãƒ³ -->
                                <Button Grid.Column="3"
                                        Style="{StaticResource IconButton}"
                                        Command="{Binding DataContext.TogglePinCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"
                                        Width="28" Height="28"
                                        Opacity="0.4">
                                    <TextBlock Text="ðŸ“Œ" FontSize="12"/>
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <Button Grid.Row="4"
                Style="{StaticResource GhostButton}"
                Command="{Binding OpenExplorerCommand}"
                Margin="0,12,0,0"
                HorizontalAlignment="Stretch">
            <TextBlock Foreground="{StaticResource TextSecondaryBrush}">
                <Run Text="ðŸ“‚"/>
                <Run Text=" ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é–‹ã"/>
            </TextBlock>
        </Button>
    </Grid>
</UserControl>
